<div class="checkout-page container-fluid">
  <div class="row d-flex justify-content-between container-fluid header">
    <h4 class="text-dark">Checkout</h4>
    <button (click)="reviewOrder()" class="btn btn-warning px-5" style="font-weight: bold;">Next</button>
  </div>
  <div *ngIf="isError" class="alert alert-warning banner">
    <span>{{message}}</span>
  </div>
  <div class="d-flex justify-content-center  container-fluid wrap">
    <div class="delivery-address-section">
      <h5 class="mb-3" style="font-weight: bolder;">Delivery Address</h5>
      <hr class="mb-2">
      <div [hidden]="hidePostcodeLoookupForm==true">
        <form #postcodeLoookupForm="ngForm" (ngSubmit)=(onSubmitPostcodeLookup(postcodeLoookupForm))>
          <div class="d-flex justify-content-between">
            <div style="width: 80%;">
              <input type="text" class="form-control ob-text-field" id="postcode" placeholder="Enter your postcode"
                required [(ngModel)]="address.postcode" name="postcode" #postcode="ngModel">
            </div>
            <div style="width: 20%;">
              <button type="submit" class="btn btn-md btn-primary mb-1 ml-1"
                [disabled]="!postcodeLoookupForm.form.valid">Search</button>
            </div>
          </div>
          <div *ngIf="postcodeAddressList !== undefined && postcodeAddressList.length > 0" class="d-flex justify-content-start mt-3">
            <div style="width: 10%; margin-right: 10px;">
              <strong>Select</strong>
            </div>
            <div style="width: 80%;">
                <select [ngModel]="selectedDeliveryAddress" (ngModelChange)="onSelectDeliveryAddress($event)" name="sel3" style="width: 100%; height: 30px;">
                    <option [ngValue]="i" *ngFor="let i of postcodeAddressList">{{ i.line_1 }}, {{ i.line_2.length > 0 ? i.line_2 : (i.locality.length > 0 ? i.locality : i.town_or_city)}}, {{ i.country}}</option>
                  </select>
            </div>
          </div>
          <div class="mt-3">
            <div class="d-flex justify-content-start align-items-center">
                <div class="address-card ml-3" *ngIf="selectedDeliveryAddress !== undefined">
                  <span *ngIf="selectedDeliveryAddress.line_1 !== undefined &&  selectedDeliveryAddress.line_1.length > 0">{{ selectedDeliveryAddress.line_1 }}</span>
                  <span *ngIf="selectedDeliveryAddress.line_2.length > 0">{{ selectedDeliveryAddress.line_2 }}</span>
                  <span *ngIf="selectedDeliveryAddress.locality.length > 0">{{ selectedDeliveryAddress.locality }}</span>
                  <span *ngIf="selectedDeliveryAddress.town_or_city.length > 0">{{ selectedDeliveryAddress.town_or_city }}</span>
                  <span *ngIf="selectedDeliveryAddress.county.length > 0">{{ selectedDeliveryAddress.county }}</span>
                  <span *ngIf="selectedDeliveryAddress.district.length > 0">{{ selectedDeliveryAddress.district }}</span>
                  <span *ngIf="selectedDeliveryAddress.country.length > 0">{{ selectedDeliveryAddress.country }}</span>
                </div>
              </div>
              <div class="d-flex justify-content-center checkout-address-action-div">
                <button type="button" class="btn btn-outline-secondary btn-sm ml-1" (click)="confirmDeliveryAddress()">Deliver to
                  this address</button>
                  <button class="btn btn-outline-danger btn-sm ml-1" (click)="cancelAddressLookupForm()">Cancel</button>
              </div>
          </div>
        </form>
      </div>
      <div [hidden]="hideAddressEditForm==true">
        <form #f="ngForm" (ngSubmit)=(onSubmitAddress(f))>
          <div class="col mb-3">
            <label for="postcode">Post/Zip code</label>
            <input type="text" class="form-control ob-text-field" id="postcode" placeholder="" required
              [(ngModel)]="address.postcode" name="postcode" #postcode="ngModel">
            <button type="submit" class="btn btn-sm btn-primarym-1" [disabled]="!f.form.valid">Search</button>
          </div>
          <div class="col mb-3">
            <label for="firstName">First name</label>
            <input type="text" class="form-control ob-text-field" id="firstName" [(ngModel)]="address.firstName"
              placeholder="" value="" name="firstName" #firstName="ngModel" required>
            <!-- <div [hidden]="firstName.valid || firstName.pristine" class="alert alert-danger">
                        </div> -->
          </div>
          <div class="col mb-3">
            <label for="lastName">Last name</label>
            <input type="text" class="form-control ob-text-field" id="lastName" placeholder="" value="" required
              [(ngModel)]="address.lastName" name="lastName" #lastName="ngModel">
            <!-- <div [hidden]="lastName.valid || lastName.pristine" class="alert alert-danger">
                            Last name is required
                        </div> -->
          </div>
          <div class="col mb-3">
            <label for="email">Email</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="text" class="form-control ob-text-field" id="email" placeholder="you@example.com" required
                [(ngModel)]="address.email" name="email" #email="ngModel">
              <!-- <div [hidden]="email.valid || email.pristine" class="alert alert-danger">
                                Please enter a valid email address for shipping updates.
                            </div> -->
            </div>
          </div>
          <div class="col mb-3">
            <label for="mobile">Mobile <span class="text-muted">(Optional)</span></label>
            <input type="text" class="form-control ob-text-field" id="mobile" placeholder="" value=""
              [(ngModel)]="address.mobile" name="mobile" #mobile="ngModel">
          </div>

          <div class="col mb-3">
            <label for="lineNumber1">Address</label>
            <input type="text" class="form-control ob-text-field" id="lineNumber2" placeholder="1234, Main St" required
              [(ngModel)]="address.lineNumber1" name="lineNumber1" #lineNumber1="ngModel">
            <!-- <div [hidden]="lineNumber1.valid || lineNumber1.pristine" class="alert alert-danger">
                            Please enter a valid address line.
                        </div> -->
          </div>

          <div class="col mb-3">
            <label for="lineNumber2">Address 2 <span class="text-muted">(Optional)</span></label>
            <input type="text" class="form-control ob-text-field" id="lineNumber2" placeholder="" [(ngModel)]="address.lineNumber2" value="" name="lineNumber2"
              #lineNumber2="ngModel">
          </div>

          <div class="col mb-3">
            <label for="city">City/Town</label>
            <input type="text" class="form-control ob-text-field" id="city" placeholder="Glasgow" required
              [(ngModel)]="address.city" name="city" #city="ngModel">
            <!-- <div [hidden]="city.valid || city.pristine" class="alert alert-danger">
                                Please enter a valid City/Town.
                            </div> -->
          </div>
          <div class="col mb-3">
            <label for="country">Country</label>
            <input type="text" class="form-control ob-text-field" id="country" placeholder="United Kingdom" required
              [(ngModel)]="address.country" name="country" #city="ngModel">
          </div>
          <div class="col h-flex mb-3">
            <button type="submit" class="btn btn-outline-primary btn-sm ml-1" [disabled]="!f.form.valid">Submit</button>
            <button class="btn btn-outline-danger btn-sm ml-1" (click)="cancelAddressForm()">Cancel</button>
          </div>
        </form>
      </div>
      <div *ngIf="hidePostcodeLoookupForm && hideAddressEditForm">
        <div class="d-flex flex-space-between p-1 mb-2">
          <strong class="text-muted">Choose a delivery address:</strong>
          <button type="button" class="btn btn-outline-secondary btn-sm ml-1" (click)="addNewAddress()">Add</button>
        </div>
        <div class="address-section-item" *ngFor="let a of addressList" [class.item-selected]="a.selected">
          <div class="d-flex justify-content-start align-items-center">
            <!-- <label class="bt-check">
                            <input type="checkbox"
                            (change)="selectAddress(a, $event)"
                            [checked]="a.selected">
                            <span class="tick"></span>
                        </label> -->
            <div class="address-card ml-3">
              <div>
                <span>{{ a.firstName }} {{a.lastName }}</span>
              </div>
              <span>{{ a.lineNumber1 }}</span>
              <span>{{ a.lineNumber2 }}</span>
              <span>{{ a.city }}</span>
              <span>{{ a.country }}</span>
              <span>{{ a.postcode }}</span>
            </div>
          </div>
          <hr class="mb-1">
          <div class="d-flex justify-content-center checkout-address-action-div">
            <button type="button" class="btn btn-outline-secondary btn-sm ml-1" (click)="selectAddress(a)">Deliver to
              this address</button>
            <button type="button" class="btn btn-outline-secondary btn-sm ml-1" (click)="editAddress(a)">Edit</button>
            <button type="button" class="btn btn-outline-secondary btn-sm ml-1"
              (click)="removeAddress(a)">Remove</button>
          </div>
        </div>
      </div>
      <div class="mt-4">
        <form>
          <label class="bt-check muted"><strong class="text-muted">My Delivery address same as Billing Address</strong>
            <input type="checkbox" (change)="shippingAndBillingAddress($event)">
            <span class="tick"></span>
          </label>
        </form>
      </div>
    </div>
    <div class="payment-section">
      <h5 class="mb-3">Payment Method</h5>
      <hr class="mb-2">
      <div [hidden]="hidePaymentForm==true">
        <form #paymentForm="ngForm" (ngSubmit)=(onSubmitPaymentMethod(paymentForm))>
          <div class="custom-control custom-radio">
            <div class="d-flex justify-content-between p-2">
              <div>
                <input id="credit" name="paymentMethod" type="radio" class="custom-control-input" checked required
                  (click)="selectType('Credit')">
                <label class="custom-control-label" for="credit">Credit Card</label>
              </div>
              <div>
                <img src="/assets/icons/visa.png" width="50px" height="32px" class="mr-1
                                        border-box px-2 rounded-lg">
                <img src="/assets/icons/mastercard.png" width="50px" height="32px" class="mr-1
                                        border-box px-2 rounded-lg">
                <img src="/assets/icons/american-express.png" width="50px" height="32px" class="mr-1
                                        border-box px-2 rounded-lg">
              </div>
            </div>
          </div>
          <div class="custom-control custom-radio">
            <div class="d-flex justify-content-between p-2">
              <div>
                <input id="paypal" name="paymentMethod" type="radio" class="custom-control-input" required
                  (click)="selectType('Paypal')">
                <label class="custom-control-label" for="paypal">Paypal</label>
              </div>
              <div>
                <img src="/assets/icons/paypal.png" width="50px" height="32px" class="mr-1
                                        border-box px-2 rounded-lg">
              </div>
            </div>
          </div>
          <div *ngIf="showCardSection">
            <div class="col mb-3">
              <label for="nameOnCard">Name on card</label>
              <input type="text" class="form-control ob-text-field" id="nameOnCard" placeholder="" required
                [(ngModel)]="card.nameOnCard" name="nameOnCard" #nameOnCard="ngModel">
              <small class="text-muted">Full name as displayed on card</small>
            </div>
            <div class="d-flex justify-content-between" style="align-items: center;align-self: center;">
              <div class="col-6 mb-3">
                <label for="cardNumber">Card number</label>
                <input type="text" maxlength="16" class="form-control ob-text-field" id="cardNumber" placeholder=""
                  required [(ngModel)]="card.cardNumber" name="cardNumber" #cardNumber="ngModel"
                  (keyup)="onKeypressCardNumberEvent($event)">
                <small class="text-muted">16 digit number without gap</small>
              </div>
              <div class="col-6" *ngIf="card.cardType !== undefined && card.cardType !== null">
                <img src="/assets/icons/visa.png" width="50px" height="32px" class="mr-1
                                            border-box px-2 rounded-lg" *ngIf="card.cardType === 'visa'">
                <img src="/assets/icons/mastercard.png" width="50px" height="32px" class="mr-1
                                            border-box px-2 rounded-lg" *ngIf="card.cardType  === 'mastercard'">
                <img src="/assets/icons/american-express.png" width="50px" height="32px" class="mr-1
                                            border-box px-2 rounded-lg" *ngIf="card.cardType  === 'amex'">
              </div>
            </div>

            <div class="d-flex justify-content-between  px-3">
              <div class="mb-3 form-group">
                <label for="expiration">Expiration Date</label>
                <div class="h-flex justify-content-start">
                    <select [ngModel]="expirationMonth" (ngModelChange)="onSelectExpiryMonth($event)" name="expiryMonthSel" style="width: 50px; height: 25px;">
                        <option [ngValue]="m" *ngFor="let m of monthsOptions">{{ m }}</option>
                    </select>
                    <select [ngModel]="expirationYear" (ngModelChange)="onSelectExpiryYear($event)" name="expiryYearSel" style="width: 60px; height: 25px; margin-left: 10px;">
                        <option [ngValue]="y" *ngFor="let y of yearsOptions">{{ y }}</option>
                    </select>
                </div>
              </div>
              <div class="mb-3">
                <label for="cvv">CVV</label>
                <input type="text" maxlength="3" class="form-control cvv-input  ob-text-field" id="cvv" placeholder=""
                  required [(ngModel)]="card.cvv" name="cvv" #cvv="ngModel">
              </div>
            </div>
            <div class="d-flex justify-content-start  px-3">
              <button type="submit" class="btn btn-sm btn-primary m-1"
                [disabled]="!paymentForm.form.valid || card.cardType === undefined || card.cardType === null">Submit</button>
              <button class="btn btn-sm btn-secondary m-1" (click)="cancelPaymentForm()">Cancel</button>
            </div>
          </div>
        </form>
      </div>

      <div *ngIf="hidePaymentForm">
        <div class="d-flex flex-space-between p-1 mb-2">
          <strong class="text-muted">Choose a payment method</strong>
          <button type="button" class="btn btn-outline-secondary btn-sm ml-1"
            (click)="addNewPaymentMethod()">Add</button>
        </div>
        <div class="d-flex justify-content-between payment-card" *ngFor="let p of paymentMethodList"
          [class.item-selected]="p.selected">
          <div class="d-flex justify-content-start" (click)="usePaymentMethod(p)">
            <!-- Payment Item -->
            <div class="payment-card-details">
              <div class="d-flex justify-content-start ">
                <strong style="align-items: center;align-self: center;">Card</strong>
                <div style="align-items: center;align-self: center;">
                  <img src="/assets/icons/visa.png" width="50px" height="32px" class="mr-1
                                            border-box px-2 rounded-lg" *ngIf="p.cardType === 'visa'">
                  <img src="/assets/icons/mastercard.png" width="50px" height="32px" class="mr-1
                                            border-box px-2 rounded-lg" *ngIf="p.cardType  === 'mastercard'">
                  <img src="/assets/icons/american-express.png" width="50px" height="32px" class="mr-1
                                            border-box px-2 rounded-lg" *ngIf="p.cardType  === 'amex'">
                </div>
              </div>
              <div class="d-flex justify-content-start">
                <strong>Ending</strong>
                <span class="pl-2">{{ getMaskedCardNumber(p) }}</span>
              </div>
              <div class="">
                <span class="mr-2">{{ p.nameOnCard}}</span>
                <span class="">{{ p.expiryMonth}}/{{p.expiryYear}}</span>
              </div>
              <div class="d-flex justify-content-start mt-3 btn-group-justified">
                <div class="btn-group ">
                  <button class="btn btn-outline-secondary btn-sm mr-1" (click)="usePaymentMethod(p)">Use this
                    card</button>
                </div>
                <div class="btn-group">
                  <button class="btn btn-outline-secondary btn-sm mr-1" (click)="editPaymentMethod(p)">Edit
                    details</button>
                </div>
                <div class="btn-group">
                  <button class="btn btn-outline-secondary btn-sm mr-1" (click)="removePaymentMethod(p)">Remove
                    this</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="basket-section  box-shadow">
      <div class="d-flex justify-content-between align-items-center">
        <h5>Review Items</h5>
        <span class="btn btn-sm btn-outline-secondary">{{
                    basket.items.length }} items</span>
      </div>
      <hr class="mb-3">
      <app-checkout-item [item]="item" *ngFor="let item of basket.items"></app-checkout-item>
      <hr class="mb-4">
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between
                    bg-light">
          <div class="text-success">
            <h6 class="my-0">Promo code</h6>
            <small>EXAMPLECODE</small>
          </div>
          <span class="text-success">-£5</span>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total </span>
          <strong>{{getBasketTotal() | currency: 'GBP'}}</strong>
        </li>
      </ul>
      <form class="card p-2">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Promo code">
          <div class="input-group-append">
            <button type="submit" class="btn btn-secondary">Redeem</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="row d-flex justify-content-end container-fluid header">
    <button (click)="reviewOrder()" class="btn btn-warning px-5" style="font-weight: bold;">Next</button>
  </div>
  <div style="height: 100px;" class="container-fluid"></div>
</div>
